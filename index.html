<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DecorReels - Decora√ß√£o que Inspira</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            overflow: hidden;
            height: 100vh;
        }
        
        ::-webkit-scrollbar { display: none; }
        
        .feed-container {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }
        
        .product-card {
            height: 100vh;
            width: 100vw;
            scroll-snap-align: start;
            position: relative;
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .media-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
            touch-action: pan-y;
        }
        
        .variants-track {
            display: flex;
            height: 100%;
            width: 100%;
            transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform;
        }
        
        .variant-slide {
            min-width: 100%;
            height: 100%;
            position: relative;
            background: #000;
        }
        
        .variant-slide img,
        .variant-slide video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .swipe-hint {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 15;
            pointer-events: none;
            font-size: 14px;
        }
        
        .swipe-hint.left { left: 12px; }
        .swipe-hint.right { right: 12px; }
        .swipe-hint.show { opacity: 1; }
        
        .gradient-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 55%;
            background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
            pointer-events: none;
            z-index: 5;
        }
        
        .variant-dots {
            position: absolute;
            bottom: 160px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }
        
        .variant-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        
        .variant-dot.active {
            background: #fff;
            width: 20px;
            border-radius: 3px;
        }
        
        .product-info {
            position: absolute;
            bottom: 90px;
            left: 20px;
            right: 90px;
            color: white;
            z-index: 10;
        }
        
        .product-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.9);
            letter-spacing: -0.5px;
            line-height: 1.1;
        }
        
        .product-description {
            font-size: 14px;
            opacity: 0.85;
            line-height: 1.4;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-shadow: 0 1px 4px rgba(0,0,0,0.8);
        }
        
        .product-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .product-price {
            font-size: 32px;
            font-weight: 800;
            color: #4ade80;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        
        .product-price .currency {
            font-size: 20px;
            font-weight: 600;
        }
        
        .color-badge {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .color-badge-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .action-buttons {
            position: absolute;
            right: 16px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            z-index: 20;
        }
        
        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:active {
            transform: scale(0.92);
            background: rgba(255,255,255,0.2);
        }
        
        .action-btn.add-cart {
            background: #4ade80;
            border-color: #4ade80;
            color: #000;
            width: 58px;
            height: 58px;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(74, 222, 128, 0.4);
        }
        
        .action-btn.add-cart:active {
            transform: scale(0.92);
            box-shadow: 0 2px 10px rgba(74, 222, 128, 0.3);
        }
        
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
        }
        
        .logo {
            font-size: 24px;
            font-weight: 800;
            color: white;
            letter-spacing: -1px;
        }
        
        .logo span { color: #4ade80; }
        
        .cart-icon {
            position: relative;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .cart-icon:active { transform: scale(0.92); }
        
        .cart-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #4ade80;
            color: #000;
            font-size: 11px;
            font-weight: 800;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.98);
            backdrop-filter: blur(30px);
            z-index: 1000;
            display: none;
            flex-direction: column;
            animation: slideUp 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .cart-modal.active { display: flex; }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .cart-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-title {
            color: white;
            font-size: 20px;
            font-weight: 700;
        }
        
        .close-cart {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .cart-item {
            display: flex;
            gap: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
        }
        
        .cart-item-info {
            flex: 1;
            color: white;
        }
        
        .cart-item-name {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 15px;
        }
        
        .cart-item-variant {
            font-size: 13px;
            opacity: 0.6;
            margin-bottom: 8px;
        }
        
        .cart-item-price {
            color: #4ade80;
            font-weight: 700;
            font-size: 16px;
        }
        
        .remove-item {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(239,68,68,0.15);
            border: none;
            color: #ef4444;
            cursor: pointer;
            align-self: center;
            font-size: 14px;
        }
        
        .cart-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.9);
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .whatsapp-btn {
            width: 100%;
            padding: 18px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s ease;
        }
        
        .whatsapp-btn:active {
            background: #128C7E;
            transform: scale(0.98);
        }
        
        .scroll-indicator {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 6px;
            z-index: 50;
        }
        
        .scroll-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        
        .scroll-dot.active {
            background: #4ade80;
            height: 20px;
            border-radius: 2px;
        }
        
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: 600;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
            gap: 20px;
        }
        
        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #4ade80;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loader-text {
            color: rgba(255,255,255,0.6);
            font-size: 14px;
        }
        
        .error-state {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            padding: 40px;
            text-align: center;
            display: none;
        }
        
        .error-state.active { display: flex; }
        
        .error-state i {
            font-size: 48px;
            color: #ef4444;
            margin-bottom: 16px;
        }
        
        .retry-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .empty-cart {
            text-align: center;
            color: rgba(255,255,255,0.4);
            padding: 60px 20px;
        }
        
        .empty-cart i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        @media (min-width: 768px) {
            .product-card {
                max-width: 480px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <div class="loader-text">Carregando produtos...</div>
    </div>

    <!-- Error State -->
    <div class="error-state" id="errorState">
        <i class="fas fa-exclamation-circle"></i>
        <h3>Erro ao carregar produtos</h3>
        <p>Verifique sua conex√£o ou tente novamente.</p>
        <button class="retry-btn" onclick="location.reload()">Tentar novamente</button>
    </div>

    <!-- Barra Superior -->
    <div class="top-bar">
        <div class="logo">Decor<span>Reels</span></div>
        <div class="cart-icon" onclick="toggleCart()">
            <i class="fas fa-shopping-bag"></i>
            <span class="cart-count" id="cartCount" style="display: none;">0</span>
        </div>
    </div>

    <!-- Indicador de Scroll -->
    <div class="scroll-indicator" id="scrollIndicator"></div>

    <!-- Feed de Produtos -->
    <div class="feed-container" id="feedContainer"></div>

    <!-- Modal do Carrinho -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <h2 class="cart-title">Seu Cesto</h2>
            <button class="close-cart" onclick="toggleCart()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart">
                <i class="fas fa-shopping-bag"></i>
                <p>Seu cesto est√° vazio</p>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total</span>
                <span id="cartTotal">R$ 0,00</span>
            </div>
            <button class="whatsapp-btn" onclick="sendToWhatsApp()">
                <i class="fab fa-whatsapp"></i>
                Enviar Pedido via WhatsApp
            </button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle" style="color: #4ade80;"></i>
        <span id="toastMessage">Adicionado ao cesto!</span>
    </div>

    <script>
        // ==========================================
        // CONFIGURA√á√ÉO AIRTABLE - EDITE AQUI
        // ==========================================
        
        const AIRTABLE_CONFIG = {
            // Substitua por suas credenciais do Airtable
            API_KEY: 'patz3pPfxv4Ptkq6p.3dcf4acdf012fa340673919038bebed9f16c84f10d69b7baa100a4d542fd52ca', // Personal Access Token
            BASE_ID: 'appKlSvikikTzy4uc', // ID da sua base
            TABLE_NAME: 'Produtos', // Nome da tabela
            
            // URL da API (n√£o altere)
            get API_URL() {
                return `https://api.airtable.com/v0/${this.BASE_ID}/${encodeURIComponent(this.TABLE_NAME)}`;
            }
        };

        // Seu n√∫mero de WhatsApp para pedidos
        const WHATSAPP_NUMBER = '5511999999999';

        // ==========================================
        // ESTADO GLOBAL
        // ==========================================
        
        let products = [];
        let cart = [];
        let currentProductIndex = 0;
        let productStates = {};

        // ==========================================
        // INICIALIZA√á√ÉO
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', () => {
            loadProductsFromAirtable();
        });

        // ==========================================
        // CARREGAMENTO AIRTABLE
        // ==========================================
        
        async function loadProductsFromAirtable() {
            try {
                showLoader(true);
                
                // Faz a requisi√ß√£o para Airtable
                const response = await fetch(AIRTABLE_CONFIG.API_URL, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                // Processa os dados do Airtable
                products = processAirtableData(data.records);
                
                if (products.length === 0) {
                    throw new Error('Nenhum produto ativo encontrado');
                }

                // Renderiza os produtos
                renderProducts();
                setupScrollObserver();
                createScrollIndicators();
                
                // Esconde loader
                setTimeout(() => {
                    showLoader(false);
                }, 500);

            } catch (error) {
                console.error('Erro ao carregar do Airtable:', error);
                showError();
            }
        }

        function processAirtableData(records) {
            return records
                .filter(record => record.fields.Ativo !== false) // S√≥ produtos ativos
                .sort((a, b) => (a.fields.Ordem || 0) - (b.fields.Ordem || 0)) // Ordena
                .map(record => {
                    const fields = record.fields;
                    
                    // Processa imagens do attachment
                    const imagens = fields.Imagens || [];
                    const video = fields.Video ? fields.Video[0] : null;
                    
                    // Processa cores (JSON ou formato simples)
                    let cores = [];
                    try {
                        if (fields.Cores) {
                            cores = JSON.parse(fields.Cores);
                        }
                    } catch (e) {
                        // Se n√£o for JSON v√°lido, ignora
                        console.warn('Formato de cores inv√°lido para:', fields.Nome);
                    }

                    // Cria varia√ß√µes combinando imagens com cores
                    const variants = imagens.map((img, index) => ({
                        id: `${record.id}_${index}`,
                        color: cores[index]?.hex || '#ccc',
                        colorName: cores[index]?.nome || `Op√ß√£o ${index + 1}`,
                        image: img.url,
                        thumbnail: img.thumbnails?.large?.url || img.url
                    }));

                    return {
                        id: record.id,
                        name: fields.Nome || 'Produto sem nome',
                        description: fields.Descricao || '',
                        price: fields.Preco || 0,
                        video: video ? video.url : null,
                        videoType: video ? video.type : null,
                        variants: variants.length > 0 ? variants : [{
                            id: `${record.id}_0`,
                            color: '#ccc',
                            colorName: 'Padr√£o',
                            image: 'https://via.placeholder.com/800x1200?text=Sem+Imagem',
                            thumbnail: 'https://via.placeholder.com/400?text=Sem+Imagem'
                        }]
                    };
                });
        }

        // ==========================================
        // RENDERIZA√á√ÉO
        // ==========================================
        
        function renderProducts() {
            const container = document.getElementById('feedContainer');
            container.innerHTML = '';

            products.forEach((product, index) => {
                const card = createProductCard(product, index);
                container.appendChild(card);
                
                productStates[product.id] = {
                    currentVariant: 0,
                    touchStartX: 0,
                    touchStartY: 0,
                    isDragging: false
                };
                
                setupSwipe(card, product.id);
            });
        }

        function createProductCard(product, index) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.index = index;
            card.dataset.productId = product.id;

            const hasVideo = product.video && product.videoType?.includes('video');
            
            const variantsHTML = product.variants.map((variant, vIndex) => `
                <div class="variant-slide" data-variant-index="${vIndex}">
                    ${hasVideo && vIndex === 0 ? `
                        <video autoplay muted loop playsinline poster="${variant.image}">
                            <source src="${product.video}" type="video/mp4">
                        </video>
                    ` : `
                        <img src="${variant.image}" alt="${product.name}" loading="${index < 2 ? 'eager' : 'lazy'}">
                    `}
                </div>
            `).join('');

            const dotsHTML = product.variants.map((_, i) => `
                <div class="variant-dot ${i === 0 ? 'active' : ''}" data-dot-index="${i}"></div>
            `).join('');

            card.innerHTML = `
                <div class="media-wrapper" id="wrapper-${product.id}">
                    <div class="variants-track" id="track-${product.id}">
                        ${variantsHTML}
                    </div>
                    
                    <div class="gradient-overlay"></div>
                    
                    <div class="variant-dots" id="dots-${product.id}">
                        ${dotsHTML}
                    </div>
                    
                    <div class="swipe-hint left" id="hint-left-${product.id}">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <div class="swipe-hint right" id="hint-right-${product.id}">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <div class="product-info">
                    <h2 class="product-title">${product.name}</h2>
                    <p class="product-description">${product.description}</p>
                    <div class="product-meta">
                        <div class="product-price">
                            <span class="currency">R$</span> ${formatPrice(product.price)}
                        </div>
                        <div class="color-badge" id="badge-${product.id}">
                            <div class="color-badge-dot" style="background-color: ${product.variants[0].color}"></div>
                            <span>${product.variants[0].colorName}</span>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <div class="action-btn" onclick="shareProduct('${product.id}')">
                        <i class="fas fa-share"></i>
                    </div>
                    <div class="action-btn add-cart" onclick="addToCart('${product.id}')">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>
            `;
            
            return card;
        }

        // ==========================================
        // GESTOS / SWIPE
        // ==========================================
        
        function setupSwipe(card, productId) {
            const wrapper = card.querySelector('.media-wrapper');
            const state = productStates[productId];

            wrapper.addEventListener('touchstart', handleTouchStart, { passive: true });
            wrapper.addEventListener('touchmove', handleTouchMove, { passive: true });
            wrapper.addEventListener('touchend', handleTouchEnd);
            
            wrapper.addEventListener('mousedown', handleMouseDown);

            function handleTouchStart(e) {
                state.touchStartX = e.touches[0].clientX;
                state.touchStartY = e.touches[0].clientY;
                state.isDragging = true;
            }

            function handleMouseDown(e) {
                state.touchStartX = e.clientX;
                state.touchStartY = e.clientY;
                state.isDragging = true;
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            }

            function handleMouseMove(e) {
                if (!state.isDragging) return;
            }

            function handleMouseUp(e) {
                if (!state.isDragging) return;
                handleEnd(e.clientX, e.clientY);
                state.isDragging = false;
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            }

            function handleTouchMove(e) {
                if (!state.isDragging) return;
            }

            function handleTouchEnd(e) {
                if (!state.isDragging) return;
                state.isDragging = false;
                const touch = e.changedTouches[0];
                handleEnd(touch.clientX, touch.clientY);
            }

            function handleEnd(endX, endY) {
                const diffX = endX - state.touchStartX;
                const diffY = endY - state.touchStartY;
                const minSwipe = 50;

                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > minSwipe) {
                    if (diffX > 0) {
                        changeVariant(productId, -1);
                        showSwipeHint(productId, 'right');
                    } else {
                        changeVariant(productId, 1);
                        showSwipeHint(productId, 'left');
                    }
                }
            }
        }

        function changeVariant(productId, direction) {
            const product = products.find(p => p.id === productId);
            const state = productStates[productId];
            const newIndex = state.currentVariant + direction;

            if (newIndex < 0 || newIndex >= product.variants.length) {
                const track = document.getElementById(`track-${productId}`);
                track.style.transform = `translateX(calc(-${state.currentVariant * 100}% + ${direction * -30}px))`;
                setTimeout(() => {
                    track.style.transform = `translateX(-${state.currentVariant * 100}%)`;
                }, 200);
                return;
            }

            state.currentVariant = newIndex;
            const variant = product.variants[newIndex];

            const track = document.getElementById(`track-${productId}`);
            track.style.transform = `translateX(-${newIndex * 100}%)`;

            const dots = document.querySelectorAll(`#dots-${productId} .variant-dot`);
            dots.forEach((dot, i) => dot.classList.toggle('active', i === newIndex));

            const badge = document.getElementById(`badge-${productId}`);
            badge.querySelector('.color-badge-dot').style.backgroundColor = variant.color;
            badge.querySelector('span').textContent = variant.colorName;

            if (product.video) {
                const videos = track.querySelectorAll('video');
                videos.forEach((v, i) => {
                    if (i === newIndex) v.play();
                    else v.pause();
                });
            }
        }

        function showSwipeHint(productId, side) {
            const hint = document.getElementById(`hint-${side}-${productId}`);
            const opposite = side === 'left' ? 'right' : 'left';
            document.getElementById(`hint-${opposite}-${productId}`).classList.remove('show');
            
            hint.classList.add('show');
            setTimeout(() => hint.classList.remove('show'), 700);
        }

        // ==========================================
        // CARRINHO
        // ==========================================
        
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const state = productStates[productId];
            const variant = product.variants[state.currentVariant];

            const existing = cart.find(item => 
                item.productId === productId && item.variantId === variant.id
            );

            if (existing) {
                existing.quantity++;
            } else {
                cart.push({
                    productId,
                    variantId: variant.id,
                    name: product.name,
                    variantName: variant.colorName,
                    price: product.price,
                    image: variant.thumbnail,
                    quantity: 1
                });
            }

            updateCartUI();
            showToast(`${product.name} adicionado!`);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartUI();
        }

        function updateCartUI() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const badge = document.getElementById('cartCount');
            
            badge.textContent = count;
            badge.style.display = count > 0 ? 'flex' : 'none';
            
            renderCartItems();
        }

        function renderCartItems() {
            const container = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-bag"></i>
                        <p>Seu cesto est√° vazio</p>
                    </div>
                `;
                document.getElementById('cartTotal').textContent = 'R$ 0,00';
                return;
            }

            container.innerHTML = cart.map((item, index) => `
                <div class="cart-item">
                    <img src="${item.image}" class="cart-item-image" alt="${item.name}">
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-variant">${item.variantName} ‚Ä¢ Qtd: ${item.quantity}</div>
                        <div class="cart-item-price">R$ ${formatPrice(item.price * item.quantity)}</div>
                    </div>
                    <button class="remove-item" onclick="removeFromCart(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartTotal').textContent = `R$ ${formatPrice(total)}`;
        }

        function toggleCart() {
            const modal = document.getElementById('cartModal');
            modal.classList.toggle('active');
            document.body.style.overflow = modal.classList.contains('active') ? 'hidden' : '';
        }

        function sendToWhatsApp() {
            if (cart.length === 0) {
                showToast('Adicione itens primeiro!');
                return;
            }

            let message = 'üõí *Pedido DecorReels*%0A%0A';
            
            cart.forEach((item, i) => {
                message += `*${i + 1}. ${item.name}*%0A`;
                message += `Cor: ${item.variantName}%0A`;
                message += `Qtd: ${item.quantity}%0A`;
                message += `Pre√ßo: R$ ${formatPrice(item.price * item.quantity)}%0A%0A`;
            });

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            message += `*Total: R$ ${formatPrice(total)}*%0A%0A`;
            message += `Gostaria de finalizar a compra!`;

            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${message}`, '_blank');
        }

        function shareProduct(productId) {
            const product = products.find(p => p.id === productId);
            
            if (navigator.share) {
                navigator.share({
                    title: product.name,
                    text: `Confira ${product.name} por R$ ${formatPrice(product.price)}`,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('Link copiado!');
            }
        }

        // ==========================================
        // SCROLL OBSERVER
        // ==========================================
        
        function setupScrollObserver() {
            const container = document.getElementById('feedContainer');
            const cards = container.querySelectorAll('.product-card');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        currentProductIndex = parseInt(entry.target.dataset.index);
                        updateScrollIndicators();

                        document.querySelectorAll('video').forEach(v => v.pause());

                        const visibleId = entry.target.dataset.productId;
                        const state = productStates[visibleId];
                        const track = document.getElementById(`track-${visibleId}`);
                        const video = track.querySelectorAll('video')[state.currentVariant];
                        if (video) video.play();
                    }
                });
            }, { threshold: 0.6 });

            cards.forEach(card => observer.observe(card));
        }

        function createScrollIndicators() {
            const container = document.getElementById('scrollIndicator');
            container.innerHTML = '';
            products.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = `scroll-dot ${i === 0 ? 'active' : ''}`;
                container.appendChild(dot);
            });
        }

        function updateScrollIndicators() {
            document.querySelectorAll('.scroll-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentProductIndex);
            });
        }

        // ==========================================
        // UI HELPERS
        // ==========================================
        
        function showLoader(show) {
            const loader = document.getElementById('loader');
            if (show) loader.classList.remove('hidden');
            else loader.classList.add('hidden');
        }

        function showError() {
            showLoader(false);
            document.getElementById('errorState').classList.add('active');
        }

        function formatPrice(price) {
            return price.toFixed(2).replace('.', ',');
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }
    </script>
</body>
</html>
